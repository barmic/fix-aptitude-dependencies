#!/bin/sh
#
# fix-aptitude-dependencies
# https://github.com/syam44/fix-aptitude-dependencies
#
# Distributed under the GNU General Public License version 3
# https://www.gnu.org/copyleft/gpl.html
#
# Authors: syam (aks92@free.fr)
#
# Description: Installer.
#
set -e

# Vérifier qu'on est bien sous root
if [ "$(id -u)" != "0" ]; then
  echo >&2 "${COLOR_ERROR}ERREUR :${COLOR_NONE} ce script nécessite les droits root."
  exit 255
fi

if [ "$1" = "purge" ] || [ "$1" = "remove" ]; then
  rm "/usr/local/sbin/fix-aptitude-dependencies" 2>/dev/null || true
  if [ "$1" = "purge" ]; then
    rm "/etc/apt/fix-aptitude-dependencies.conf" 2>/dev/null || true
  fi
elif [ "$1" = "install" ]; then
  "$0" remove
  cd "$(dirname "$(readlink -f "$0")")"
  cp "./fix-aptitude-dependencies" "/usr/local/sbin/"
  chown root:root "/usr/local/sbin/fix-aptitude-dependencies"
  chmod 750 "/usr/local/sbin/fix-aptitude-dependencies"
  if [ -f "/etc/fix-aptitude-dependencies.conf" ]; then
    mv --no-clobber "/etc/fix-aptitude-dependencies.conf" "/etc/apt/fix-aptitude-dependencies.conf"
  fi
  cp --no-clobber "./fix-aptitude-dependencies.conf" "/etc/apt/"
  chown root:root "/etc/apt/fix-aptitude-dependencies.conf"
  chmod 644 "/etc/apt/fix-aptitude-dependencies.conf"
else
  echo "Usage: $(basename "$0") install | remove | purge"
fi
